<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Jolokia plot demo</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.js" integrity="sha256-t7kx8nPDixJ3ucbB9OBcTsCYhaSHvdrzJ54tfkmjjhI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.time.js" integrity="sha256-pYLIMq3HE4prBar2HxbrrCdHAfG+Sv6nfnOaHDS5xBo=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.js" integrity="sha256-EZJ68U7eUi8uSP0MRRUalYten2eOlhREE9kJOIbIeYg=" crossorigin="anonymous"></script>
  
  <script src="js/jolokia-min.js"></script>
  <script src="js/jolokia-simple-min.js"></script>
</head>
<body>
<h1>[Jolokia Web Viewer]</h1>

<h2>Memory Usage</h2>

<input type="text" id="endpoint" size="50" value="https://your-gateway/actuator/jolokia"/>
<input type="submit" id="start" value="Start"/>

<div id="memory" style="width:600px; height:300px; margin-top: 20px;"></div>

<input type="submit" id="gc" value="Garbage Collection"/ disabled="true">

<script id="source" language="javascript" type="text/javascript">

  var data = [];
  var j4p ;

  function start() {
    var inputEndpoint = $("#endpoint") ;
    var endpoint = inputEndpoint.val() ;

    console.log("Endpoint: "+ endpoint);

    j4p = new Jolokia({url: endpoint,jsonp: true});

    inputEndpoint.prop('disabled', true);
    $("#start").prop('disabled', true);
    $("#gc").prop('disabled', false);

    run();
  }

  function run() {
    j4p.request({
                  type: "read",
                  mbean: "java.lang:type=Memory",
                  attribute: "HeapMemoryUsage"
                },
                {
                  success: function(resp) {
                    var value = resp.value.used / (1024 * 1024);
                    var time = resp.timestamp * 1000;
                    data.push([time, value]);
                    $.plot($("#memory"),[data],{xaxis: { mode: "time" }});
                    setTimeout(run,1000);
                  }
                });
  }

  $("#start").click(start);

  $("#gc").click(function() {
    j4p.execute("java.lang:type=Memory","gc", {
          success: function() {
              console.log("Garbage collection performed");
          }
     });
  });
  
</script>
</body>
</html>